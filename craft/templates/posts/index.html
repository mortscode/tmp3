{% extends "_layout" %}

{% set photoArray = [entry.featuredImage[0].url('facebookSeo'), entry.featuredImage[0].url] %}

{% for block in entry.postBuilder.with(['photos:imageFiles']) %}
  {% if block.type.handle == 'photos' %}
    {% for photo in block.imageFiles %}
      {% if photo.height > photo.width %}
        {% set photoArray = photoArray|merge([photo.url]) %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}

{% set seomaticMeta = seomaticMeta | merge({
    og: {
        image: photoArray[0:6],
    }
}) %}

{% block content %}
  {% set recipe = entry.recipeBuilder|length or entry.recipeMethod|length %}
  {% set articleType = recipe ? 'Recipe' : 'Article' %}
  <div class="post-entry" itemscope itemtype="http://schema.org/{{articleType}}">
    <div class="post-intro">
      <div class="post-intro__title">
        <time class="post-intro__title--date">{{entry.postDate.format('F d, Y')}}</time>
        <h1 class="post-intro__title--text">{{entry.title}}</h1>
        {% if entry.postAuthor|length %}
          <span class="post-intro__title--author author">Story by {{entry.postAuthor}}</span>
        {% endif %}
        {% include 'posts/_share' %}
        {% if recipe %}
          {% spaceless %}
          <button class="post-intro__title--button js-scroll-to" data-scroll-target='recipe'>
            <div class="post-intro__title--button-text">Jump to recipe</div>
            {% include 'utils/icon' with {'icon':'chevron-down', 'classes':'post-intro__title--chevron'} %}
          </button>
          {% endspaceless %}
        {% endif %}
      </div>
      <div class="post-intro__image">
        {% set imageAlt = entry.featuredImage[0].imageAlt ? entry.featuredImage[0].imageAlt : entry.postEntrySeo.seoTitle %}
        {% set vars = {
          'image': entry.featuredImage[0],
          'lazyImage': true,
          'classes': 'post-intro__image--asset',
          'title': imageAlt,
        }%}
        {% include 'utils/images/home-feature-pic' with vars %}
      </div>
      {% if recipe %}
        <button class="post-intro__title--mobile-jump js-scroll-to btn gray small" data-scroll-target='recipe'>Jump to recipe</button>
      {% endif %}
      <div class="post-intro__pintip">
        {% spaceless %}
        <span class="post-intro__pintip--message"><span>
          {% include 'utils/icon' with {
            'icon': 'pinterest',
            'classes': 'post-intro__pintip--icon'
          } %}
        </span>Tap any image to pin it.</span>
        {% endspaceless %}
      </div>
    </div>
    <div class="post js-fix-share-trigger">
      {% include 'posts/_post-builder' %}

      {% if recipe %}
        {% include 'posts/_recipe-builder' %}
      {% endif %}
    </div>
  </div>
  
  {% include 'posts/_more-posts' %}

  <div class="comments__wrapper disqus">
    <div id="disqus_thread" class="comments"></div>
  </div>
  {% include 'posts/_fixed-share' %}
{% endblock %}

{% if entry.recipeBuilder|length or entry.recipeMethod|length %}
  {% block postMeta %}
    <meta itemprop="name" content="{{ entry.postEntrySeo.seoTitle }}" />
    <meta itemprop="description" content="{{ entry.postSummary }}" />
    <meta itemprop="url" content="{{ entry.url }}" />
    <meta itemprop="image" content="{{ entry.featuredImage[0].url }}" />
    <meta itemprop="dateCreated" content="{{ entry.postDate.iso8601() }}" />
    <meta itemprop="dateModified" content="{{ entry.dateUpdated.iso8601() }}" />
    {% for imageUrl in photoArray[1:7] %}
      <meta itemprop="image" content="{{ imageUrl }}" />
    {% endfor %}
    {% if entry.recipeBuilder|length %}
      {% for block in entry.recipeBuilder %}	
        {% for item in block.list %}	
          <meta itemprop="recipeIngredient" content="{{ item.amount }} {{ item.ingredient }}" />
        {% endfor %}	
      {% endfor %}
    {% endif %}
    {% if entry.recipeMethod|length %}
      <meta itemprop="recipeInstructions" content="{{ entry.recipeMethod|striptags }}">
    {% endif %}
    {% if entry.recipeServings > 0 %}
      <meta itemprop="recipeYield" content="{{ entry.recipeServings }} servings">
    {% endif %}
  {% endblock %}
{% endif %}

{% block footerJs %}
{% include 'posts/scripts/_pinterest' %}
{% include 'posts/scripts/_disqus' %}
{% include 'posts/scripts/_facebook' %}
{% include 'posts/scripts/_twitter' %}
{% endblock %}
